<!DOCTYPE html><HTML lang="en"><head><meta charset="UTF-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>Distributed FFT plans · PencilFFTs.jl</title><link href="https://jipolanco.github.io/PencilFFTs.jl/PencilFFTs/" rel="canonical"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script data-main="../assets/documenter.js" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" data-theme-name="documenter-dark" href="../assets/themes/documenter-dark.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-light" data-theme-primary="" href="../assets/themes/documenter-light.css" rel="stylesheet" type="text/css"/><script src="../assets/themeswap.js"></script><link href="../assets/custom.css" rel="stylesheet" type="text/css"/><script src="../assets/tomate.js"></script><script data-outdated-warner="">function maybeAddWarning () {
    const head = document.getElementsByTagName('head')[0];

    // Add a noindex meta tag (unless one exists) so that search engines don't index this version of the docs.
    if (document.body.querySelector('meta[name="robots"]') === null) {
        const meta = document.createElement('meta');
        meta.name = 'robots';
        meta.content = 'noindex';

        head.appendChild(meta);
    };

    // Add a stylesheet to avoid inline styling
    const style = document.createElement('style');
    style.type = 'text/css';
    style.appendChild(document.createTextNode('.outdated-warning-overlay {  position: fixed;  top: 0;  left: 0;  right: 0;  box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);  z-index: 999;  background-color: #ffaba7;  color: rgba(0, 0, 0, 0.7);  border-bottom: 3px solid #da0b00;  padding: 10px 35px;  text-align: center;  font-size: 15px; }  .outdated-warning-overlay .outdated-warning-closer {    position: absolute;    top: calc(50% - 10px);    right: 18px;    cursor: pointer;    width: 12px; }  .outdated-warning-overlay a {    color: #2e63b8; }    .outdated-warning-overlay a:hover {      color: #363636; }'));
    head.appendChild(style);

    const div = document.createElement('div');
    div.classList.add('outdated-warning-overlay');
    const closer = document.createElement('div');
    closer.classList.add('outdated-warning-closer');

    // Icon by font-awesome (license: https://fontawesome.com/license, link: https://fontawesome.com/icons/times?style=solid)
    closer.innerHTML = '<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" class="svg-inline--fa fa-times fa-w-11" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></svg>';
    closer.addEventListener('click', function () {
        document.body.removeChild(div);
    });
    let href = '/stable';
    if (window.documenterBaseURL) {
        href = window.documenterBaseURL + '/../stable';
    }
    div.innerHTML = 'This documentation is not for the latest version. <br> <a href="' + href + '">Go to the latest documentation</a>.';
    div.appendChild(closer);
    document.body.appendChild(div);
};

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', maybeAddWarning);
} else {
    maybeAddWarning();
};
</script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img alt="PencilFFTs.jl logo" src="../assets/logo.svg"/></a><div class="docs-package-name"><span class="docs-autofit">PencilFFTs.jl</span></div><form action="../search/" class="docs-search"><input class="docs-search-query" id="documenter-search-query" name="q" placeholder="Search docs" type="text"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li><span class="tocitem">More examples</span><ul><li><a class="tocitem" href="../examples/in-place/">In-place transforms</a></li><li><a class="tocitem" href="../examples/gradient/">Gradient of a scalar field</a></li></ul></li><li><span class="tocitem">Library</span><ul><li class="is-active"><a class="tocitem" href="">Distributed FFT plans</a><ul class="internal"><li><a class="tocitem" href="#Creating-plans"><span>Creating plans</span></a></li><li><a class="tocitem" href="#Allocating-data"><span>Allocating data</span></a></li><li><a class="tocitem" href="#Methods"><span>Methods</span></a></li></ul></li><li><a class="tocitem" href="../Transforms/">Available transforms</a></li><li><a class="tocitem" href="../PencilFFTs_timers/">Measuring performance</a></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Internals</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../GlobalFFTParams/">Global FFT parameters</a></li></ul></li></ul></li><li><a class="tocitem" href="../benchmarks/">Benchmarks</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Library</a></li><li class="is-active"><a href="">Distributed FFT plans</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="">Distributed FFT plans</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jipolanco/PencilFFTs.jl/blob/master/docs/src/PencilFFTs.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" href="#" id="documenter-settings-button" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" href="#" id="documenter-sidebar-button"></a></div></header><article class="content" id="documenter-page"><h1 id="Distributed-FFT-plans"><a class="docs-heading-anchor" href="#Distributed-FFT-plans">Distributed FFT plans</a><a id="Distributed-FFT-plans-1"></a><a class="docs-heading-anchor-permalink" href="#Distributed-FFT-plans" title="Permalink"></a></h1><p>Distributed FFTs are implemented in the <code>PencilFFTs</code> module, and are built on top of the <a href="https://github.com/jipolanco/PencilArrays.jl">PencilArrays</a> package.</p><h2 id="Creating-plans"><a class="docs-heading-anchor" href="#Creating-plans">Creating plans</a><a id="Creating-plans-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-plans" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.PencilFFTPlan" id="PencilFFTs.PencilFFTPlan"><code>PencilFFTs.PencilFFTPlan</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">PencilFFTPlan{T,N}</code></pre><p>Plan for N-dimensional FFT-based transform on MPI-distributed data.</p><hr/><pre><code class="language-none">PencilFFTPlan(
    size_global::Dims{N}, transforms, proc_dims::Dims{M}, comm::MPI.Comm,
    [real_type = Float64];
    extra_dims = (),
    fftw_flags = FFTW.ESTIMATE,
    fftw_timelimit = FFTW.NO_TIMELIMIT,
    permute_dims = Val(true),
    transpose_method = Transpositions.PointToPoint(),
    timer = TimerOutput(),
)</code></pre><p>Create plan for N-dimensional transform.</p><p><strong>Extended help</strong></p><p><code>size_global</code> specifies the global dimensions of the input data.</p><p><code>transforms</code> should be a tuple of length <code>N</code> specifying the transforms to be applied along each dimension. Each element must be a subtype of <a href="../Transforms/#PencilFFTs.Transforms.AbstractTransform"><code>Transforms.AbstractTransform</code></a>. For all the possible transforms, see <a href="../Transforms/#Transform-types">Transform types</a>. Alternatively, <code>transforms</code> may be a single transform that will be automatically expanded into <code>N</code> equivalent transforms. This is illustrated in the example below.</p><p>The transforms are applied one dimension at a time, with the leftmost dimension first for forward transforms. For multidimensional FFTs of real data, this means that a real-to-complex FFT must be performed along the first dimension, and then complex-to-complex FFTs are performed along the other two dimensions (see example below).</p><p>The data is distributed over the MPI processes in the <code>comm</code> communicator. The distribution is performed over <code>M</code> dimensions (with <code>M &lt; N</code>) according to the values in <code>proc_dims</code>, which specifies the number of MPI processes to put along each dimension.</p><p><strong>Optional arguments</strong></p><ul><li><p>The floating point precision can be selected by setting <code>real_type</code> parameter, which is <code>Float64</code> by default.</p></li><li><p><code>extra_dims</code> may be used to specify the sizes of one or more extra dimensions that should not be transformed. These dimensions will be added to the rightmost (i.e. slowest) indices of the arrays. See <strong>Extra dimensions</strong> below for usage hints.</p></li><li><p>The keyword arguments <code>fftw_flags</code> and <code>fftw_timelimit</code> are passed to the <code>FFTW</code> plan creation functions (see <a href="https://juliamath.github.io/AbstractFFTs.jl/stable/api/#AbstractFFTs.plan_fft"><code>AbstractFFTs</code> docs</a>).</p></li><li><p><code>permute_dims</code> determines whether the indices of the output data should be reversed. For instance, if the input data has global dimensions <code>(Nx, Ny, Nz)</code>, then the output of a complex-to-complex FFT would have dimensions <code>(Nz, Ny, Nx)</code>. This enables FFTs to always be performed along the first (i.e. fastest) array dimension, which could lead to performance gains. This option is enabled by default. For type inference reasons, it must be a value type (<code>Val(true)</code> or <code>Val(false)</code>).</p></li><li><p><code>transpose_method</code> allows to select between implementations of the global data transpositions. See <a href="https://jipolanco.github.io/PencilArrays.jl/dev/Transpositions/#PencilArrays.Transpositions.Transposition">PencilArrays docs</a> docs for details.</p></li><li><p><code>timer</code> should be a <code>TimerOutput</code> object. See <a href="../PencilFFTs_timers/#PencilFFTs.measuring_performance">Measuring performance</a> for details.</p></li></ul><p><strong>Extra dimensions</strong></p><p>One possible application of <code>extra_dims</code> is for describing the components of a vector or tensor field. However, this means that different <code>PencilFFTPlan</code>s would need to be created for each kind of field (scalar, vector, ...). To avoid the creation of multiple plans, a possibly better alternative is to create tuples (or arrays) of <code>PencilArray</code>s using <a href="#PencilFFTs.allocate_input"><code>allocate_input</code></a> and <a href="#PencilFFTs.allocate_output"><code>allocate_output</code></a>.</p><p>Another more legitimate usage of <code>extra_dims</code> is to specify one or more Cartesian dimensions that should not be transformed nor split among MPI processes.</p><p><strong>Example</strong></p><p>Suppose we want to perform a 3D FFT of real data. The data is to be decomposed along two dimensions, over 8 MPI processes:</p><pre><code class="language-julia">size_global = (64, 32, 128)  # size of real input data

# Perform real-to-complex transform along the first dimension, then
# complex-to-complex transforms along the other dimensions.
transforms = (Transforms.RFFT(), Transforms.FFT(), Transforms.FFT())
# transforms = Transforms.RFFT()  # this is equivalent to the above line

proc_dims = (4, 2)  # 2D decomposition
comm = MPI.COMM_WORLD

plan = PencilFFTPlan(size_global, transforms, proc_dims, comm)</code></pre></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/8e0b0bf14b5465633aa516d3443eaa6ecc44fd91/src/pencil_plans.jl#LL38-L142" target="_blank">source</a></section></article><h2 id="Allocating-data"><a class="docs-heading-anchor" href="#Allocating-data">Allocating data</a><a id="Allocating-data-1"></a><a class="docs-heading-anchor-permalink" href="#Allocating-data" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.allocate_input" id="PencilFFTs.allocate_input"><code>PencilFFTs.allocate_input</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">allocate_input(p::PencilFFTPlan)          -&gt; PencilArray
allocate_input(p::PencilFFTPlan, dims...) -&gt; Array{PencilArray}
allocate_input(p::PencilFFTPlan, Val(N))  -&gt; NTuple{N, PencilArray}</code></pre><p>Allocate uninitialised <a href="https://jipolanco.github.io/PencilArrays.jl/dev/PencilArrays/#PencilArrays.PencilArray"><code>PencilArray</code></a> that can hold input data for the given plan.</p><p>The second and third forms respectively allocate an array of <code>PencilArray</code>s of size <code>dims</code>, and a tuple of <code>N</code><code>PencilArray</code>s.</p><div class="admonition is-info"><header class="admonition-header">In-place plans</header><div class="admonition-body"><p>If <code>p</code> is an in-place plan, a <a href="https://jipolanco.github.io/PencilArrays.jl/dev/PencilArrays/#PencilArrays.ManyPencilArray"><code>ManyPencilArray</code></a> is allocated. This type holds <code>PencilArray</code> wrappers for the input and output transforms (as well as for intermediate transforms) which share the same space in memory. The input and output <code>PencilArray</code>s should be respectively accessed by calling <a href="https://jipolanco.github.io/PencilArrays.jl/dev/PencilArrays/#Base.first-Tuple{ManyPencilArray}"><code>first(::ManyPencilArray)</code></a> and <a href="https://jipolanco.github.io/PencilArrays.jl/dev/PencilArrays/#Base.last-Tuple{ManyPencilArray}"><code>last(::ManyPencilArray)</code></a>.</p><h4>Example</h4><p>Suppose <code>p</code> is an in-place <code>PencilFFTPlan</code>. Then,</p><pre><code class="language-julia">@assert is_inplace(p)
A = allocate_input(p) :: ManyPencilArray
v_in = first(A)       :: PencilArray  # input data view
v_out = last(A)       :: PencilArray  # output data view</code></pre><p>Also note that in-place plans must be performed directly on the returned <code>ManyPencilArray</code>, and not on the contained <code>PencilArray</code> views:</p><pre><code class="language-julia">p * A       # perform forward transform in-place
p \ A       # perform backward transform in-place
# p * v_in  # not allowed!!</code></pre></div></div></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/8e0b0bf14b5465633aa516d3443eaa6ecc44fd91/src/pencil_plans.jl#LL450-L490" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.allocate_output" id="PencilFFTs.allocate_output"><code>PencilFFTs.allocate_output</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">allocate_output(p::PencilFFTPlan)          -&gt; PencilArray
allocate_output(p::PencilFFTPlan, dims...) -&gt; Array{PencilArray}
allocate_output(p::PencilFFTPlan, Val(N))  -&gt; NTuple{N, PencilArray}</code></pre><p>Allocate uninitialised <a href="https://jipolanco.github.io/PencilArrays.jl/dev/PencilArrays/#PencilArrays.PencilArray"><code>PencilArray</code></a> that can hold output data for the given plan.</p><p>If <code>p</code> is an in-place plan, a <a href="https://jipolanco.github.io/PencilArrays.jl/dev/PencilArrays/#PencilArrays.ManyPencilArray"><code>ManyPencilArray</code></a> is allocated.</p><p>See <a href="#PencilFFTs.allocate_input"><code>allocate_input</code></a> for details.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/8e0b0bf14b5465633aa516d3443eaa6ecc44fd91/src/pencil_plans.jl#LL516-L527" target="_blank">source</a></section></article><h2 id="Methods"><a class="docs-heading-anchor" href="#Methods">Methods</a><a id="Methods-1"></a><a class="docs-heading-anchor-permalink" href="#Methods" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" href="#PencilArrays.Pencils.MPITopologies.get_comm-Tuple{PencilFFTPlan}" id="PencilArrays.Pencils.MPITopologies.get_comm-Tuple{PencilFFTPlan}"><code>PencilArrays.Pencils.MPITopologies.get_comm</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">get_comm(p::PencilFFTPlan)</code></pre><p>Get MPI communicator associated to a <code>PencilFFTPlan</code>.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/8e0b0bf14b5465633aa516d3443eaa6ecc44fd91/src/pencil_plans.jl#LL427-L431" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.get_scale_factor-Tuple{PencilFFTPlan}" id="PencilFFTs.get_scale_factor-Tuple{PencilFFTPlan}"><code>PencilFFTs.get_scale_factor</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">get_scale_factor(p::PencilFFTPlan)</code></pre><p>Get scale factor associated to a <code>PencilFFTPlan</code>.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/8e0b0bf14b5465633aa516d3443eaa6ecc44fd91/src/pencil_plans.jl#LL434-L438" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilArrays.Pencils.get_timer-Tuple{PencilFFTPlan}" id="PencilArrays.Pencils.get_timer-Tuple{PencilFFTPlan}"><code>PencilArrays.Pencils.get_timer</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">get_timer(p::PencilFFTPlan)</code></pre><p>Get <code>TimerOutput</code> attached to a <code>PencilFFTPlan</code>.</p><p>See <a href="../PencilFFTs_timers/#PencilFFTs.measuring_performance">Measuring performance</a> for details.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/8e0b0bf14b5465633aa516d3443eaa6ecc44fd91/src/pencil_plans.jl#LL441-L447" target="_blank">source</a></section></article><article class="docstring"><header><a class="docstring-binding" href="#PencilFFTs.Transforms.is_inplace-Tuple{PencilFFTPlan}" id="PencilFFTs.Transforms.is_inplace-Tuple{PencilFFTPlan}"><code>PencilFFTs.Transforms.is_inplace</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">Transforms.is_inplace(p::PencilFFTPlan)</code></pre><p>Returns <code>true</code> if the given plan operates in-place on the input data, <code>false</code> otherwise.</p></div><a class="docs-sourcelink" href="https://github.com/jipolanco/PencilFFTs.jl/blob/8e0b0bf14b5465633aa516d3443eaa6ecc44fd91/src/pencil_plans.jl#LL234-L239" target="_blank">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../examples/gradient/">« Gradient of a scalar field</a><a class="docs-footer-nextpage" href="../Transforms/">Available transforms »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label></p><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div><p></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 11 November 2020 10:50">Wednesday 11 November 2020</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></HTML>